<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <title>Bash Prompt Builder - Andrewray.me</title>
        <script src="https://ajax.googleapis.com/ajax/libs/mootools/1.3.2/mootools-yui-compressed.js" type="text/javascript"></script>
        <script src="mootools-more-1.3.2.1.js" type="text/javascript"></script>
        <script src="mootools.noisy.min.js" type="text/javascript"></script>
        <script src="FunForms.js" type="text/javascript"></script>
        <link type="text/css" rel="stylesheet" href="FunForms.css" />
        <script src="builder.js" type="text/javascript"></script>
        <link type="text/css" rel="stylesheet" href="builder.css" />
    </head>
    <body>
        <div class="wrap">
            <div class="header">
                <h1>Bash Prompt Builder</h1>
            </div>

            <ul class="nav">
                <li>Explore:</li>
                <li><a href="#nav-options">Options</a></li>
                <li><a href="#preview">Preview</a></li>
                <li><a href="#code">Code</a></li>
                <li><a href="#what">What is this I don't even</a></li>
            </ul>

            <h2 id="nav-options">Options</h2>
            <div class="section" id="options">
                <div class="config config-git">
                    <div class="group">
                        <input type="checkbox" value="git" id="git" data-toggle="git-ahead git-modified git-conflicted" checked="checked" />
                        <label for="git">Git</label>
                    </div>

                    <div class="options">
                        <div class="group">
                            <input type="checkbox" value="git-ahead" id="git-ahead" checked="checked" />
                            <label for="git-ahead">Git Ahead</label>
                        </div>

                        <div class="group">
                            <input type="checkbox" value="git-modified" id="git-modified" checked="checked" />
                            <label for="git-modified">Git Modified</label>
                        </div>

                        <div class="group">
                            <input type="checkbox" value="git-conflicted" id="git-conflicted" checked="checked" />
                            <label for="git-conflicted">Git Conflicted</label>
                        </div>
                    </div>
                </div>

                <div class="config config-git">
                    <div class="group">
                        <input type="checkbox" value="hg" id="hg" data-toggle="hg-modified hg-conflicted" checked="checked" />
                        <label for="hg">Mercurial</label>
                    </div>

                    <div class="options">
                        <div class="group">
                            <input type="checkbox" value="hg-modified" id="hg-modified" checked="checked" />
                            <label for="hg-modified">Mercurial Modified</label>
                        </div>

                        <div class="group">
                            <input type="checkbox" value="hg-conflicted" id="hg-conflicted" checked="checked" />
                            <label for="hg-conflicted">Mercurial Conflicted</label>
                        </div>
                    </div>
                </div>

                <div class="config config-git">
                    <div class="group">
                        <input type="checkbox" value="svn" id="svn" data-toggle="svn-modified" checked="checked" />
                        <label for="svn">Subversion</label>
                    </div>

                    <div class="options">
                        <div class="group">
                            <input type="checkbox" value="svn-modified" id="svn-modified" checked="checked" />
                            <label for="svn-modified">Subversion Modified</label>
                        </div>
                    </div>
                </div>

                <div class="config characters">
                    <div class="group">
                        <label for="modified-char">Modified Character</label>
                        <input type="text" value="༇" />
                    </div>

                    <div class="group">
                        <label for="conflict-char">Conflict Character</label>
                        <input type="text" value="௰" />
                    </div>
                </div>
            </div>

            <h2 id="preview">Preview</h2>
            <div class="section display">

                <label for="git-display" class="git">Git</label>
                <div class="git" id="git-display">
                    <span class="git-branch">(master<span class="delta-char git-modified"> ༇</span>)</span><span class="git-ahead"> +1</span><span class="git-conflicted"> (<span class="conflict-char">௰</span> index.js, package.json)</span> $ 
                </div>

                <label for="hg-display" class="hg">Mercurial</label>
                <div class="hg" id="hg-display">
                    <span class="hg-branch">(master<span class="delta-char hg-modified"> ༇</span>)</span><span class="hg-conflicted"> (<span class="conflict-char">௰</span> index.js, package.json)</span> $ 
                </div>
                
                <label for="svn-display" class="svn">Subversion</label>
                <div class="svn" id="svn-display">
                    <span class="svn-branch">(svn:revno<span class="delta-char svn-modified"> ༇</span>)</span> $ 
                </div>
            </div>

            <h2>Code</h2>
            <div class="section">
                <div id="function">
dvcs_function="
    # Figure out what repo we are in

    # :git
        gitBranch=\"\"
    # /git

    # :svn
        svnInfo=\"\"
    # /svn

    # :hg
        hgBranch=\$(hg prompt \"{branch}\" 2> /dev/null)

        # Done for speed reasons. Feel free to swap
        if [[ \"\$hgBranch\" == \"\" ]]; then
    # /hg
    # :git
        gitBranch=\$(git symbolic-ref HEAD 2> /dev/null)

        if [[ \"\$gitBranch\" == \"\" ]]; then
    # /git
    # :svn
        # Svn?
        svnInfo=\$(svn info 2> /dev/null)
    # /svn

    # :git
        fi
    # /git
    # :hg
        fi
    # /hg

    # Build the prompt!
    prompt=\"\"

    # :conflict
        files=\"\"
    # /conflict

    # :git
        # If we are in git ...
        if [[ \"\$gitBranch\" != \"\" ]]; then
            # find current branch
            gitStatus=\$(git status)

            # :git-modified
                # changed *tracked* files in local directory?
                gitChange=\$(echo \$gitStatus | ack 'modified:|deleted:|new file:')
                if [[ \"\$gitChange\" != \"\" ]]; then
                    gitChange=\" \\[`tput sc`\\]  \\[`tput rc`\\]\\[\$DELTA_CHAR\\] \"
                fi
            # /git-modified

            # :git-branch
                # output the branch and changed character if present
                prompt=\$prompt\"\\[\$COLOR_YELLOW\\] (\"\${gitBranch#refs/heads/}\"\$gitChange)\\[\$COLOR_RESET\\]\"
            # /git-branch

            # :git-ahead
                # How many local commits do you have ahead of origin?
                num=\$(echo \"\$gitStatus\" | grep \"Your branch is ahead of\" | awk '{split(\$0,a,\" \"); print a[9];}') || return
                if [[ \"\$num\" != \"\" ]]; then
                    prompt=\$prompt\"\\[\$COLOR_LIGHT_CYAN\\] +\$num\"
                fi
            # /git-ahead

            # :conflicts
                # any conflicts? (sed madness is to remove line breaks)
                files=\$(git ls-files -u | cut -f 2 | sort -u | sed -e :a -e '\$!N;s/\\\n/, /;ta' -e 'P;D')
            # /conflicts
        fi
    # /git

    # If we are in mercurial ...
    # :hg
        if [[ \"\$hgBranch\" != \"\" ]]; then

            # :hg-modified
                # changed files in local directory?
                hgChange=\$(hg status | ack '^M|^!')
                if [[ \"\$hgChange\" != \"\" ]]; then
                    hgChange=\" \\[`tput sc`\\]  \\[`tput rc`\\]\\[\$DELTA_CHAR\\] \"
                else
                    hgChange=\"\"
                fi
            # /hg-modified

            # :hg-branch
                # output branch and changed character if present
                prompt=\$prompt\"\\[\$COLOR_PURPLE\\] (\${hgBranch}\$hgChange)\"

                # I guess we don't want this (better version?)
                #num=\$(hg summary | grep \"update:\" | wc -l | sed -e 's/^ *//')
                #if [[ \"\$num\" != \"\" ]]; then
                    #prompt=\$prompt\"\\[\$COLOR_LIGHT_CYAN\\] +\$num\"
                #fi
            # /hg-branch

            # :conflicts
            # Conflicts?
                files=\$(hg resolve -l | grep \"U \" | awk '{split(\$0,a,\" \"); print a[2];}') || return
            # /conflicts
        fi
    # /hg

    # :svn
        # If we are in subversion ...
        if [[ \"\$svnInfo\" != \"\" ]]; then

            # :svn-changed
                # changed files in local directory? NOTE: This command is the slowest of the bunch
                svnChange=\$(svn status | ack \"^M|^!\" | wc -l)
                if [[ \"\$svnChange\" != \"       0\" ]]; then
                    svnChange=\" \\[`tput sc`\\]  \\[`tput rc`\\]\\[\$DELTA_CHAR\\] \"
                else
                    svnChange=\"\"
                fi
            # /svn-changed

            # revision number (instead of branch name, silly svn)
            revNo=\$(echo \"\$svnInfo\" | sed -n -e '/^Revision: \([0-9]*\).*\$/s//\1/p')
            prompt=\$prompt\"\\[\$COLOR_BLUE\\] (svn:\$revNo\$svnChange)\\[\$COLOR_RESET\\]\"
        fi
    # /svn

    # :conflicts
        # Show conflicted files if any
        if [[ \"\$files\" != \"\" ]]; then
            prompt=\$prompt\" \\[\$COLOR_RED\\](\\[\$COLOR_YELLOW\\]\"
            prompt=\$prompt\"\\[`tput sc`\\]  \\[`tput rc`\\]\\[\$CONFLICT_CHAR\\] \"
            prompt=\$prompt\"\\[\$COLOR_RED\\]\${files})\"
        fi
    # /conflicts

    echo -e \$prompt"
            </div>

        function error_test() {
            if [[ $? = "0" ]]; then
                printf "$COLOR_LIGHT_GREEN"
            else
                printf "$COLOR_LIGHT_RED"
            fi
        }

    PS1="\n\[$COLOR_YELLOW\]\u\[\$(error_test)\]@\[$COLOR_GREEN\]\w\$(${dvcs_function})\[$COLOR_RESET\] \$ "
        </div>
        <h2 id="what">What is this I don't even</h2>
        <div class="section what">
        </div>
        </div>
    </body>
</html>
